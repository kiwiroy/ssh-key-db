# Generated by git-ship. See 'git-ship --man' for help or https://github.com/jhthorsen/app-git-ship
use strict;
use warnings;

use ExtUtils::MakeMaker;

# perl Makefile.PL (from git repo) copies 'key_db' -> 'bin/key_db'

if (-e 'key-db') {
    for my $file ("bin/key-db") {
        print STDERR "Generating $file from key-db\n";
        open my $in,  "<key-db" or die $!;
        open my $out, ">$file" or die $!;
        while (<$in>) {
            s|^#!/usr/bin/env perl|#!perl|; # so MakeMaker can fix it
            print $out $_;
        }
    }
}

sub get_version {
  local @ARGV = @_;
  my $code = do { local $/; <> };
  my $app = eval "$code" or die $@;
  return $app->_script->version;
}

WriteMakefile(
  NAME => 'SSH::PublicKey',
  AUTHOR => 'Roy Storey <roy.storey@plantandfood.co.nz>',
  LICENSE => 'artistic_2',
  ABSTRACT_FROM => 'lib/SSH/PublicKey.pm',
  VERSION => get_version("./bin/key-db"),
  EXE_FILES => [qw{bin/key-db}],
  META_MERGE => {
    resources => {
      bugtracker => 'https://github.com/kiwiroy/ssh-key-db/issues',
      homepage => 'https://github.com/kiwiroy/ssh-key-db',
      repository => 'https://github.com/kiwiroy/ssh-key-db.git',
    },
  },
  BUILD_REQUIRES => {
  'Test::Applify' => '0.04',
  'Test::More' => '0.88'
}
,
  PREREQ_PM => {
  'Applify' => '0.14',
  'Mojolicious' => '7.55',
  'perl' => 'v5.10.0'
}
,
  test => {TESTS => (-e 'META.yml' ? 't/*.t' : 't/*.t xt/*.t')},
);
